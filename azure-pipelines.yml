trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '18.x'
  displayName: 'Install Node.js'

# Install dependencies inside demo-app folder
- script: npm install
  workingDirectory: demo-app
  displayName: 'Install Dependencies'

# Build React app inside demo-app folder
- script: npm run build
  workingDirectory: demo-app
  displayName: 'Build React App'

# Publish the build artifacts
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: 'demo-app/build'
    ArtifactName: 'drop'
    
# Deploy to Azure Static Web App
- task: AzureStaticWebApp@0
  inputs:
    azure_subscription: '<YOUR-SERVICE-CONNECTION>'  # Required
    app_location: 'demo-app'                        # React app folder
    output_location: 'build'                        # Build output
    api_location: ''                                # No API (optional)
    skip_app_build: true                            # Build already done above
  displayName: "Deploy to Azure Static Web App"